<!doctype html>
<html class="no-js">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>shareIn</title>
<link href="../../images/logo-icon.svg" rel="icon" type="image/svg"><script>var pathToRoot = "../../";</script>
    <script>document.documentElement.classList.replace("no-js","js");</script>    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="../../scripts/sourceset_dependencies.js" async></script>
<link href="../../styles/style.css" rel="Stylesheet">
<link href="../../styles/jetbrains-mono.css" rel="Stylesheet">
<link href="../../styles/main.css" rel="Stylesheet">
<link href="../../styles/prism.css" rel="Stylesheet">
<link href="../../styles/logo-styles.css" rel="Stylesheet">
<script type="text/javascript" src="../../scripts/clipboard.js" async></script>
<script type="text/javascript" src="../../scripts/navigation-loader.js" async></script>
<script type="text/javascript" src="../../scripts/platform-content-handler.js" async></script>
<script type="text/javascript" src="../../scripts/main.js" defer></script>
<script type="text/javascript" src="../../scripts/prism.js" async></script>
<script type="text/javascript" src="../../scripts/symbol-parameters-wrapper_deferred.js" defer></script></head>
<body>
    <div class="root">
<nav class="navigation" id="navigation-wrapper">
    <div class="navigation--inner">
        <div class="navigation-title">
            <button class="menu-toggle" id="menu-toggle" type="button">toggle menu</button>
            <div class="library-name">
<a class="library-name--link" href="../../index.html">
                            kotlinx.coroutines
                    </a>            </div>
            <div class="library-version">1.6.4-SNAPSHOT
            </div>
        </div>
        <div class="filter-section" id="filter-section">
                <button class="platform-tag platform-selector common-like" data-active="" data-filter=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain">common</button>
        </div>
    </div>
    <div class="navigation-controls">
        <button class="navigation-controls--btn navigation-controls--theme" id="theme-toggle-button" type="button">switch theme</button>
        <div class="navigation-controls--btn navigation-controls--search" id="searchBar" role="button">search in API</div>
    </div>
</nav>
        <div id="container">
            <div class="sidebar" id="leftColumn">
                <div class="sidebar--inner" id="sideMenu"></div>
            </div>
            <div id="main">
<div class="main-content" id="content" pageids="kotlinx-coroutines-core::kotlinx.coroutines.flow//shareIn/kotlinx.coroutines.flow.Flow[TypeParam(bounds=[kotlin.Any?])]#kotlinx.coroutines.CoroutineScope#kotlinx.coroutines.flow.SharingStarted#kotlin.Int/PointingToDeclaration//1975948010">
  <div class="breadcrumbs"><a href="../index.html">kotlinx-coroutines-core</a><span class="delimiter">/</span><a href="index.html">kotlinx.coroutines.flow</a><span class="delimiter">/</span><span class="current">shareIn</span></div>
  <div class="cover ">
    <h1 class="cover"><span>share</span><wbr><span><span>In</span></span></h1>
  </div>
  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="symbol monospace"><span class="token keyword"></span><span class="token keyword">fun </span><span class="token operator">&lt;</span><span class="token keyword"></span><a href="share-in.html">T</a><span class="token operator">&gt; </span><a href="-flow/index.html">Flow</a><span class="token operator">&lt;</span><span class="token keyword"></span><a href="share-in.html">T</a><span class="token operator">&gt;</span><span class="token punctuation">.</span><a href="share-in.html"><span class="token function">shareIn</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">scope<span class="token operator">: </span><a href="../kotlinx.coroutines/-coroutine-scope/index.html">CoroutineScope</a><span class="token punctuation">, </span></span><span class="parameter ">started<span class="token operator">: </span><a href="-sharing-started/index.html">SharingStarted</a><span class="token punctuation">, </span></span><span class="parameter ">replay<span class="token operator">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html">Int</a><span class="token operator"> = </span><span class="token constant">0</span></span></span><span class="token punctuation">)</span><span class="token operator">: </span><a href="-shared-flow/index.html">SharedFlow</a><span class="token operator">&lt;</span><span class="token keyword"></span><a href="share-in.html">T</a><span class="token operator">&gt;</span><span class="clearfix"><span class="floating-right">(<a href="https://github.com/kotlin/kotlinx.coroutines/tree/master/kotlinx-coroutines-core/common/src/flow/operators/Share.kt#L135">source</a>)</span></span></div><p class="paragraph">Converts a <i>cold</i> <a href="-flow/index.html">Flow</a> into a <i>hot</i> <a href="-shared-flow/index.html">SharedFlow</a> that is started in the given coroutine <a href="share-in.html">scope</a>, sharing emissions from a single running instance of the upstream flow with multiple downstream subscribers, and replaying a specified number of <a href="share-in.html">replay</a> values to new subscribers. See the <a href="-shared-flow/index.html">SharedFlow</a> documentation for the general concepts of shared flows.</p><p class="paragraph">The starting of the sharing coroutine is controlled by the <a href="share-in.html">started</a> parameter. The following options are supported.</p><ul><li><p class="paragraph"><a href="-sharing-started/-companion/-eagerly.html">Eagerly</a> — the upstream flow is started even before the first subscriber appears. Note that in this case all values emitted by the upstream beyond the most recent values as specified by <a href="share-in.html">replay</a> parameter <strong>will be immediately discarded</strong>.</p></li><li><p class="paragraph"><a href="-sharing-started/-companion/-lazily.html">Lazily</a> — starts the upstream flow after the first subscriber appears, which guarantees that this first subscriber gets all the emitted values, while subsequent subscribers are only guaranteed to get the most recent <a href="share-in.html">replay</a> values. The upstream flow continues to be active even when all subscribers disappear, but only the most recent <a href="share-in.html">replay</a> values are cached without subscribers.</p></li><li><p class="paragraph"><a href="-sharing-started/-companion/-while-subscribed.html">WhileSubscribed()</a> — starts the upstream flow when the first subscriber appears, immediately stops when the last subscriber disappears, keeping the replay cache forever. It has additional optional configuration parameters as explained in its documentation.</p></li><li><p class="paragraph">A custom strategy can be supplied by implementing the <a href="-sharing-started/index.html">SharingStarted</a> interface.</p></li></ul><p class="paragraph">The <code class="lang-kotlin">shareIn</code> operator is useful in situations when there is a <i>cold</i> flow that is expensive to create and/or to maintain, but there are multiple subscribers that need to collect its values. For example, consider a flow of messages coming from a backend over the expensive network connection, taking a lot of time to establish. Conceptually, it might be implemented like this:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val backendMessages: Flow&lt;Message&gt; = flow {<br>    connectToBackend() // takes a lot of time<br>    try {<br>      while (true) {<br>          emit(receiveMessageFromBackend())<br>      }<br>    } finally {<br>        disconnectFromBackend()<br>    }<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">If this flow is directly used in the application, then every time it is collected a fresh connection is established, and it will take a while before messages start flowing. However, we can share a single connection and establish it eagerly like this:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val messages: SharedFlow&lt;Message&gt; = backendMessages.shareIn(scope, SharingStarted.Eagerly)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Now a single connection is shared between all collectors from <code class="lang-kotlin">messages</code>, and there is a chance that the connection is already established by the time it is needed.</p><h3 class=""> Upstream completion and error handling</h3><p class="paragraph"><strong>Normal completion of the upstream flow has no effect on subscribers</strong>, and the sharing coroutine continues to run. If a strategy like <a href="-sharing-started/-companion/-while-subscribed.html">SharingStarted.WhileSubscribed</a> is used, then the upstream can get restarted again. If a special action on upstream completion is needed, then an <a href="on-completion.html">onCompletion</a> operator can be used before the <code class="lang-kotlin">shareIn</code> operator to emit a special value in this case, like this:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">backendMessages<br>    .onCompletion { cause -&gt; if (cause == null) emit(UpstreamHasCompletedMessage) }<br>    .shareIn(scope, SharingStarted.Eagerly)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Any exception in the upstream flow terminates the sharing coroutine without affecting any of the subscribers, and will be handled by the <a href="share-in.html">scope</a> in which the sharing coroutine is launched. Custom exception handling can be configured by using the <a href="catch.html">catch</a> or <a href="retry.html">retry</a> operators before the <code class="lang-kotlin">shareIn</code> operator. For example, to retry connection on any <code class="lang-kotlin">IOException</code> with 1 second delay between attempts, use:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val messages = backendMessages<br>    .retry { e -&gt;<br>        val shallRetry = e is IOException // other exception are bugs - handle them<br>        if (shallRetry) delay(1000)<br>        shallRetry<br>    }<br>    .shareIn(scope, SharingStarted.Eagerly)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class=""> Initial value</h3><p class="paragraph">When a special initial value is needed to signal to subscribers that the upstream is still loading the data, use the <a href="on-start.html">onStart</a> operator on the upstream flow. For example:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">backendMessages<br>    .onStart { emit(UpstreamIsStartingMessage) }<br>    .shareIn(scope, SharingStarted.Eagerly, 1) // replay one most recent message</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><h3 class=""> Buffering and conflation</h3><p class="paragraph">The <code class="lang-kotlin">shareIn</code> operator runs the upstream flow in a separate coroutine, and buffers emissions from upstream as explained in the <a href="buffer.html">buffer</a> operator's description, using a buffer of <a href="share-in.html">replay</a> size or the default (whichever is larger). This default buffering can be overridden with an explicit buffer configuration by preceding the <code class="lang-kotlin">shareIn</code> call with <a href="buffer.html">buffer</a> or <a href="conflate.html">conflate</a>, for example:</p><ul><li><p class="paragraph"><code class="lang-kotlin">buffer(0).shareIn(scope, started, 0)</code> — overrides the default buffer size and creates a <a href="-shared-flow/index.html">SharedFlow</a> without a buffer. Effectively, it configures sequential processing between the upstream emitter and subscribers, as the emitter is suspended until all subscribers process the value. Note, that the value is still immediately discarded when there are no subscribers.</p></li><li><p class="paragraph"><code class="lang-kotlin">buffer(b).shareIn(scope, started, r)</code> — creates a <a href="-shared-flow/index.html">SharedFlow</a> with <code class="lang-kotlin">replay = r</code> and <code class="lang-kotlin">extraBufferCapacity = b</code>.</p></li><li><p class="paragraph"><code class="lang-kotlin">conflate().shareIn(scope, started, r)</code> — creates a <a href="-shared-flow/index.html">SharedFlow</a> with <code class="lang-kotlin">replay = r</code>, <code class="lang-kotlin">onBufferOverflow = DROP_OLDEST</code>, and <code class="lang-kotlin">extraBufferCapacity = 1</code> when <code class="lang-kotlin">replay == 0</code> to support this strategy.</p></li></ul><h3 class=""> Operator fusion</h3><p class="paragraph">Application of <a href="flow-on.html">flowOn</a>, <a href="buffer.html">buffer</a> with <a href="../kotlinx.coroutines.channels/-channel/-factory/-r-e-n-d-e-z-v-o-u-s.html">RENDEZVOUS</a> capacity, or <a href="cancellable.html">cancellable</a> operators to the resulting shared flow has no effect.</p><h3 class=""> Exceptions</h3><p class="paragraph">This function throws <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-illegal-argument-exception/index.html">IllegalArgumentException</a> on unsupported values of parameters or combinations thereof.</p><h4 class="">Parameters</h4><div class="table" data-togglable="Parameters"><div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>scope</span></span></u></div></span></div><div><div class="title"><p class="paragraph">the coroutine scope in which sharing is started.</p></div></div></div></div><div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>started</span></span></u></div></span></div><div><div class="title"><p class="paragraph">the strategy that controls when sharing is started and stopped.</p></div></div></div></div><div class="table-row" data-filterable-current=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain" data-filterable-set=":kotlinx-coroutines-core:dokkaHtmlPartial/commonMain"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>replay</span></span></u></div></span></div><div><div class="title"><p class="paragraph">the number of values replayed to new subscribers (cannot be negative, defaults to zero).</p></div></div></div></div></div></div></div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>© 2023 Copyright</span><span class="pull-right"><span>Generated by </span><a href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
            </div>
        </div>
    </div>
</body>
</html>

